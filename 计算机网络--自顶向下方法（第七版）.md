## 计算机网络--自顶向下方法（第七版）

### 第一章：计算机网络和因特网

#### 1.1 什么是因特网

其一，描述因特网的具体构成，即**构成因特网的基本硬件和软件组件**；其二，我们能够根据为分布式应用**提供服务**的**联网基础设施**来描述因特网。

> 具体构成描述：因特网是一个世界范围的计算机网络，即它是一个互联了遍及全世界数十亿计算设备的网络。

**端系统（end system）**也称**主机（host）**：容纳（即运行）应用程序，可以分为客户端（client）和服务器（server）；

**通信链路（communication link）**：不同的链路由不同的材料组成，包括同轴电缆、铜线、光纤和无线电频谱；拥有不同的传输速率（transmission rate）比特/秒（bit/s,或bps）

**分组交换机（packet switch）**：两种最著名的类型是路由器（router）和链路层交换机（link-layer switch）

**分组（packet**）：当一台端系统要向另一台端系统发送数据时，发送端系统将数据分段，并为每段加上首部字节。由此形成的信息包用计算机网络的术语来说称为分组。

**路径（mute/path）**：一个分组所经历的一系列通信链路和分组交换机称为通过该网络的路径；

**因特网服务提供商（Internet Service Provider, ISP）**：端系统通过ISP接入因特网；每个ISP自身就是一个由多台分组交换机和多段通信链路组成的网络。各ISP为端系统提供了各种不同类型的网络接入，包括如线缆调制解调器或DSL那样的住宅宽带接入、 高速局域网接入和移动无线接入。

**协议（protocol）**：控制因特网中信息的接收和发送，由端系统、分组交换机和其他因特网部件运行。

**TCP （Transmission Control Protocol,传输控制协议）**

**IP（Internet Protocol,网际协议）：**IP协议定义了在路由器和端系统之间发送和接收的分组格式。

**因特网标准（Internet standard）：**由**因特网工程任务组(Internet Engineering Task Force, IETF )**研发。IETF的标准文档称为**请求评论(Request For Comment, RFC)**。

> 服务描述：为应用程序提供服务的基础设施

因为这些应用程序涉及多个相互交换数据的端系统，故它们被称为**分布式应用程序(distributed applicalion)**。

**套接字接口( socket interface)**：一种规则集合----该接口规定了运行在一个端系统上的程序请求因特网基础设施向运行在另一个端系统上的特定目的地程序交付数据的方式。

>协议（protocol）：定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和/或接收一条报文或其他事件所采取的动作

#### 1.2 网络边缘

端系统和应用程序处于网络边缘。

**接入网**：将端系统物理连接到其**边缘路由器（edge router）**的网络。边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器。

**数字用户线（Digital Subscriber Line,DSL）**：单根DSL线路承载不同频率编码的数据信号和电话信号。

**本地中心局（CO）**

**数字用户线接入复用器（DSLAM）**：把数据和电话信号分隔开，并将数据送往因特网。数百甚至上千个家庭与同一个DSLAM相连。

**电缆因特网接入（cable Internet access）**： 利用了有线电视公司现有的有线电视基础设施。

**电缆调制解调器（cable modem）**：电缆因特网接入需要特殊的调制解调器

**光纤到户(Fiber To The Home, FTTH)**：有多种光纤分配方案，其中有一种从中心局岀来的每根光纤实际上由许多家庭共享，直到相对接近这些家庭的位置，该光纤才分成每户一根光纤。进行这种分配有两种有竞争性的光纤分布体系结构：**主动光纤网络（Active Optical Network,AON)和被动光纤网络(Passive Optical Network, PON)**。

> 使用接入网的几种环境：
>

1. 家庭接入：DSL、电缆、FTTH、拨号和卫星。宽带住宅接入有两种最流行的类型：**数字用户线（Digital Subscriber Line,DSL）和电缆**。住户通常从提供本地电话接入的本地电话公司处获得DSL因特网接入。因此，当使用DSL时，用户的本地电话公司也是它的ISP。<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200209110013052.png" alt="image-20200209110013052" style="zoom:50%;" />

2. 企业（和家庭）接入：以太网和WiFi

   **局域网（LAN）**

   **以太网**到目前为止 是公司、大学和家庭网络中最为流行 的接入技术。基于IEEE 802. 11技术的无线LAN接入,更通俗地称为WiFi。

3. 广域无线接入：3G和LTE

   设备应用了与蜂窝移动电话相同的无线基础设施，通过蜂窝网提供商运营的基站来发送和接收分组。

> 物理媒体

包括双绞铜线、同轴电缆、多模光纤缆、陆地无线电频谱和卫星无线电频谱。分成两种类型：**导引型媒体(guided media)**和**非导引型媒体(unguided media)** 。

+ 对于导引型媒体，电波沿着固体媒体前行，如光缆、双绞铜线或同轴电缆。

  + 双绞铜线：最便宜并且最常用的导引型传输媒体是双绞铜线。一对电线构成了一个通信链路。**无屏蔽双绞线(Unshielded Twisted Pair, UTP)**常用 在建筑物内的计算机网络中，即用于局域网(LAN)中。
  + 同轴电缆：同轴电缆由两个铜导体组成，但是这两个导体是同心的而不是并行的。
  
  + 光纤：一种细而柔软的、能够导引光脉冲的媒体，每个脉冲表示一个比特。一根光 纤能够支持极高的比特速率，高达数十甚至数百Gbps。光发射、接收、交换器成本较高。
+ 对于非导引型媒体，电波在空气或外层空间中传播，例如在无线局域网或数字卫星频道中。
  + 陆地无线电信道：无线电信道承载电磁频谱中的信号。它不需要安装物理线路，并具有穿透墙壁、提供与移动用户的连接以及长距离承载信号的能力。分为三类：短距离（无线头戴式耳机、键盘和医疗设备）；局域（无线LAN）；广域（蜂窝接入技术）
  + 卫星无线电信道：常用同步卫星和近地卫星

#### 1.3 网络核心

**网络核心**，即由互联因特网端系统的**分组交换机和链路构成**的网状网络。通过网络链路和交换机移动数据有两种基本方法：电路交换（circuit switching）和分组交换（packet switching）。

> 分组交换

1. 分组：**报文（message）**划分成的较小的数据块；

2. **存储转发传输（store-and-forward transmission）**：在交换机能够开始向输岀链路传输该分组的第一个比特之前，必须接收到整个分组。多数分组交换机在链路的输入端使用该机制。

   ​																		*delay = NL/R*

3. **排队时延（queuing delay）**：如果到达的分组需要传输到某条链路，但发现该链路正忙于传输其他分组，该到达分组必须在输出缓存中等待。

4. **分组丢失（丢包）（packet loss）**：因为缓存空间的大小是有限的，一个到达的分组可能发现该缓存已被其他等待传输的分组完全充满了，到达的分组或已经排队的分组之一将被丢弃。

5. **转发表（forwarding table）**：路由器具有一个转发表，用于将目的地址映射成为输出链路。因特网具备**路由选择协议（routing protocol）**，用于自动设置这些转发表。

> 电路交换

在电路交换网络中，在端系统间通信会话期间，预留了端系统间沿路径通信所需要的资源（缓存，链路传输速率）；而分组交换则不预留。

电路交换网络中的复用：链路中的电路是通过**频分复用(Frequency- Division Multiplexing, FDM )**或**时分复用（Time-Division Multiplexing, TDM）**来实现的：

> 分组交换VS电路交换：电路交换有静默期（silent period），但是能够保证实时服务；分组交换时延不可预测，提供了更好的带宽共享，简单有效低成本。

> 网络的网络

**存在点(Point of Presence, PoP)**：PoP存在于等级结构的所有层次，但底层(接入ISP)等级除外。一个POP只是提供商网络中的一台或多台路由器 (在相同位置)群组，其中客户ISP能够与提供商ISP连接。

**多宿(multi-home)**：任何ISP (除了第一层ISP)可以与两个或更多提供商ISP连接。

**对等(peer)**：位于相同等级结构层次的邻近一对ISP能够对等，也就是说，能够直接将它们的网络连到一起，使它们之间的所有流量经直接连接而不是通过上游的中间ISP传输。

**因特网交换点(Internet Exchange Point, IXP)**：IXP是一个汇合点，多个ISP 能够在这里一起对等。

+ 网络结构1: 用单一的全球传输ISP互联所有接入ISP。
+ 网络结构2: 由数十万接入ISP和多个全球传输ISP组成
+ 网络结构3：在中国，每个城市有接入ISP，它们与省级ISP连接，省级ISP又与国家级ISP连接，国家级ISP最终与第一层ISP连接。这个多层等级结构仍然仅仅是今天因特网的粗略近似。
+ 网络结构4: 网络结构3上增加 存在点、多宿、对等和因特网交换点。
+ 网络结构5: 它描述了现今的因特网，它通过在网络结构4顶部增加**内容提供商网络(content provider network )**构建而成。

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200209145553203.png" alt="image-20200209145553203" style="zoom:50%;" />

#### 1.4 分组交换网中的时延、丢包和吞吐量

**节点处理时延(nodal processing delay)**：检查分组首部和决定将该分组导向何处所需要的时间；如检查比特级别的差错所需要的时间；*微秒或更低*

**排队时延(queuing delay)**：一个特定分组的排队时延长度将取决于先期到达的正在排队等待向链路传输的分组数量。*毫秒到微秒量级*。通常使用统计量来度量，如平均排队时延、排队时延的方差和排队时延超过某些特定值的概率。

**传输时延 (transmission delay)**：是将所有分组的比特推向链路(即传输，或者说发射)所需要的时间；*毫秒到微秒量级*

**传播时延(propagation delay)**：从该链路的起点到路由器B 传播所需要的时间是传播时延；*毫秒量级*

<u>传输时延和传播时延比较：传输时路由器推出packet所有比特的时间，与分组长度和传输时间有关；传播时延是路由器之间距离和传播速率（约等于光速）。</u>

**流量强度（traffic intensity）**：*La/R*  a分组到达队列的平均速率；L分组所含比特；R传输速率

*La/R*，则比特到达队列的平均速率超过从该队列传输岀去的速率，该队列趋向于无限增加，并且排队时延将趋向无穷大。

**瞬时吞吐量（instantaneous throughput）**单位bps

**平均吞吐量（average throughput）**吞吐量取决于数据流过的链路的传输速率



#### 1.5 协议层次及其服务模型

以**分层（layer）**的方式组织协议以及实现这些协议的网络硬件和软件。每个协议属于这些层次之一。某层向它的上一层提供的服务，即所谓一层的**服务模型（service model）**。

各层的所有协议被称为**协议栈（protocol stack）。** 因特网的协议栈由5个层次组成：**物理层、链路层、网络层、运输层和应用层。**

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200210115557252.png" alt="image-20200210115557252" style="zoom:50%;" />

1. **应用层**：网络应用程序及它们的应用层协 议存留的地方。因特网的应用层包括许多协议，例如**HTTP** （它提供了 Web文档的请求和 传送）、SMTP （它提供了电子邮件报文的传输）、**FTP** （它提供两个端系统之间的文件传 送）、**DNS**（域名系统）。应用层的信息分组packet称为**报文**。
2. **运输层**：运输层在应用程序端点之间传送应用层报文。有两种运输协议：**TCP和UDP**。
3. **网络层（IP层）**：网络层负责将称为**数据报（datagram）**的网络层分组从一台主机移动到另一 台主机。包括**网际协议IP，决定路由的路由选择协议**。
4. **链路层**：在每个节点，网络层将数据报下传给链路层，链路层沿着路径将数据报传递给下一个节点。在该下一个节点，链路层将数据报上传给网络层。包括**以太网、WiFi和电缆接入网的DOCSIS协议**。把链路层分组称为**帧（fnmie）**。
5. **物理层**：物理层的任务是将该**帧**中的一个个**比特**从一个节点移动到下一个节点。在这层中的协议与该链路（例如，双绞铜线、单模光纤）的实际传输媒体相关。

**开放系统互连（OSI）参考模型**：国际标准化组织（ISO）提出计算机网络围绕7层来组织。

**表示层**的作用是使通信的应用程序能够解释交换数据的含义。这些服务包括数据压缩和数据加密（它们是自解释的）以及数据描述（这使得应用程序不必担心在各台计算机中表示/ 存储的内部格式不同的问题）。

**会话层**提供了数据交换的定界和同步功能，包括了建立检查点和恢复方案的方法。

在每一 层，一个分组具有两种类型的字段：首部字段和**有效载荷字段（payload field）**；有效载荷通常是来自上一层的分组。

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200210142014551.png" alt="image-20200210142014551" style="zoom:50%;" />





#### 1.6 面对攻击的网络

#### 1.7 计算机网络和因特网的历史

### 第二章： 应用层

#### 2.1 应用层协议原理

**应用程序体系结构(application architecture)**：两种主流体系结构。**客户-服务器体系结构构（client-server architecture）**或**对等（P2P）体系结构**（具有自扩展性，尽管每个对等方都由于请求文件产生工作负载，但每个<u>对等方</u>通过向其他对等方分发文件也为系统增加服务能力）。

进行通信的实际上是**进程**（process）而不是程序。

在两个不同端系统上的**进程**，通过跨越计算机网络交换**报文（message）**而相互通信。发送进程生成并向网络中发送报文；接收进程接收这些报文并可能通过回送报文进行响应。

> 进程通信

对每对通信进程, 我们通常将这两个进程之一标识为**客户（client，发起通信）**，而另一个进程标识为**服务器（server，等待联系）**。

进程通过一个称为**套接字（socket）**的软件接口向网络发送报文和从网络接收报文。套接字是同一台主机内**应用层与运输层之间的接口**。

由于该套接字是建立网络应用程序的可编程接口，因此套接字也称为应用程序和网络之间的**应用程序编程接口（Application Programming Interface, API）**。

> 可供应用程序使用的运输服务

1. 可靠数据传输  容忍丢失的应用(loss-tolerant application)
2. 吞吐量  具有吞吐量要求的应用程序被称为带宽敏感的应用（bandwidth-sensitive application）；弹性应用（elastic application）能够根据 当时可用的带宽或多或少地利用可供使用的吞吐量。
3. 定时  对交互式实时应用程序
4. 安全性

**TCP服务**

TCP向它的应用程序提供了**面向连接的服务**：通过握手创建全双工TCP连接；**可靠的数据传送服务**：无差错发送；**拥塞控制机制**：拥塞时会抑制发送进程。

TCP的加密版本称为**安全套接字层（Secure Sockets Layer, SSL）** 。

**UDP服务**

UDP协议向它的应用程序提供**无连接服务**。这是一种不提供不必要服务的服务，没有可靠性，没有流量控制，也没有拥塞控制。在本书中，我们把运输层的分组称为**报文段**（segment）。

> **应用层协议（application-layer protocol）**

+ 交换的报文类型，例如请求报文和响应报文。**类型**
+ 各种报文类型的语法，如报文中的各个字段及这些字段是如何描述的。**格式**
+ 字段的语义，即这些字段中的信息的含义。**含义**
+ 确定一个进程何时以及如何发送报文，对报文进行响应的规则。**时间**

应用层协议有公用的（RFC文档）也有专用的。

#### 2.2 WEB和HTTP

Web的应用层协议是**超文本传输协议（Hyper-Text Transfer Protocol, HTTP）**,它是Web的核心，是个**无状态协议(stateless protocol)**。HTTP使用TCP作为支撑传输协议。

**往返时间（Round-Trip Time, RTT）**：一个短分组从客户到服务器然后再返回客户所花费的时间。

**非持续连接的http**：一次html请求总的响应时间：前两次握手--一个RTT；第三次握手和http请求报文--一个RTT；服务器传输html文件的时间。

**持续连接的http**：节省时间，经过一定时间间隔没有被使用，连接中断。

**<u>HTTP报文格式</u>**

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200211132325689.png" alt="image-20200211132325689" style="zoom:50%;" />

HTTP请求报文的**第一行**叫作**请求行（request line）**，其**后继的行**叫作**首部行（header line）**。

方法：包括GET、POST、HEAD、PUT和DELETE；

url：请求对象 不包括IP、域名；

http版本：http/1.1；

首部字段名：host（主机）、connection（连续or非连续）、User-agent（浏览器类型）、Accept-language

实体体：使用GET方法时实体体为空，而使用POST方法时才使用；

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200211135310178.png" alt="image-20200211135310178" style="zoom:50%;" />

http版本：http/1.1；

状态码：200、301（请求的对象已经被永久转移了，location时新的url）、400（bad request服务器不能理解）、404（没找到）、505（http版本不支持）；

状态信息：OK；

首部字段名：connetction；date（发送响应报文的时间和日期）；server（服务器类型）；last-modified（对象创建或者最后修改的时间和日期）；content-length（被发送对象的字节数）；content-type（实体体中的对象类型）。

> cookie，允许站点对用户进行跟踪

cookie技术有4部分：请求报文首部行；响应报文首部行；用户端系统浏览器；后端数据库。

> web缓存器（web cache）也叫代理服务器（proxy server）

首先，Web缓存器可以大大减少对客户请 求的响应时间；Web缓存器能够大大减少一个机构的接入链路到因特网的通信量。

通过使用**内容分发网络（Content Distribution Network, CDN）** ， Web缓存器正在因特网中发挥着越来越重要的作用。CDN公司在因特网上安装了许多地理上分散的缓存器，因而使大量流量实现了本地化。

**条件GET （conditional GET）方法**：一种允许缓存器证实它的对象是最新的机制。①请求报文使用GET 方法；②请求报文中包含一个首部行“ If-Modified-Since： ”。代理服务器会根据last-modified 向初始服务器进行请求，判断该对象缓存是否已经过期。

#### 2.3 因特网中的电子邮件

因特网电子邮件系统的总体情况。从该图中我们可以看到它有3个主要组成部分：**用户代理（user agent）、邮件服务器（mail server）和简单邮件传输协议（Simple Mail Transfer Protocol, SMTP）** 。

**<u>SMTP协议：简单邮件传输协议</u>**（25端口号）

使用TCP传输协议，每台邮件服务器上既运行SMTP的客户端也运行SMTP的服务器端。**SMTP 一般不使用中间邮件服务器发送邮件**！SMTP用的是持续连接。

| 区别 | SMTP                   | HTTP                 |
| ---- | ---------------------- | -------------------- |
| 1    | 推协议 push protocol   | 拉协议 pull protocol |
| 2    | 必须按照7比特ASCII编码 | 无限制               |
| 3    | 所有对象放在一个报文中 | 封装到http响应报文   |

**<u>SMTP报文格式</u>**

> 首部：必须含有From：xxx和To：xxx，可以包含Subject：xxx等其他首部行。
>
> 空行。
>
> 报文体：7比特ASCII编码。

**<u>邮件访问协议：</u>**

+ 第三版的邮局协议（Post Office Protocol—Version 3 , POP3）：随着建立TCP连接，POP3按照三个阶段进行工作：特许（authorization）、事务处理以及更新。
+ 因特网邮件访问协议（Internet Mail Access Protocol, IMAP）
+ HTTP：电子邮件报文从浏览器发送到邮件服务器，使用的是HTTP 而不是SMTP。然而，邮件服务器之间仍然使用的是SMTP。

#### 2.4 DNS：因特网的目录服务

**域名系统 （Domain Name System, DNS）**：能进行主机名到IP地址转换的目录服务。①一个由分层的DNS服务器（DNS server）实现的分布式数据库；②一个使得主机能够查询分布式数据库的应用层协议。 DNS 服务器通常是运行 BIND（ Berkeley Internet Name Domain）软件的 UNIX机器。DNS协议运行在UDP之上，使用53号端口。

DNS协议通常被其他应用层协议使用。提供服务如下：

1. 主机名和IP地址转换；
2. 主机别名--规范主机名--IP；
3. 邮件服务器别名（同上）；
4. 负载均衡：循环多个IP地址的次序；

> 分布式、层次数据库：

没有一台DNS服务器拥有因特网上所有主机的映射。有3种类型的DNS服务器：根DNS服务器、顶级域(Top-Level Domain, TLD)DNS服务器和权威DNS服务器。客户端先联系根服务器，再联系顶级域服务器，最后联系权威服务器。

<u>本地DNS服务器（local DNS server）</u>：不属于层次结构中，可以利用本地DNS缓存减少查询。

共同实现DNS分布式数据库的所有DNS服务器存储了**资源记录**(Resource Record,RR)， RR提供了主机名到IP地址的映射。每个DNS回答报文包含了**一条或多条**资源记录。

资源记录是一个包含了下列字段的4元组：

| Name   | Value                       | Type  | TTL              |
| ------ | --------------------------- | ----- | ---------------- |
| 主机名 | 主机IP                      | A     | 该记录的生存时间 |
| 域     | 该域中主机IP的权威DNS主机名 | NS    | 它决定了RR从缓存 |
| 别名   | 规范主机名                  | CNAME | 中删除的时间     |
| 别名   | 邮件服务器的规范主机名      | MX    |                  |

**<u>DNS报文</u>**

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200211202239358.png" alt="image-20200211202239358" style="zoom:50%;" />

首部区域（前12个字节）：

+ 标识符：16比特；
+ 标志：“查询/回答”标志、权威标志、希望递归标志、递归可用标志；
+ 4个数量，对应后面四个区域；

问题区域：查询的名字（主机名字）；类型（即type）

回答区域：最初请求的名字 的资源记录RR，可包含多条RR；

权威区域：其他权威服务器的记录；

附加区域：其他有帮助的记录

#### 2.5 P2P文件分发

使用P2P体系结构，对总是打开的基础设施服务器有最小的（或者没有）依赖。成对间歇连接的主机（称为对等方）彼此直接通信。

**在P2P文件分发中，每个对等方能够向任何其他对等方重新分发它已经收到的该文件的任何部分，从而在分发过程中协助该服务器。**因此P2P体系结构具有自扩展性。

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200212101424264.png" alt="image-20200212101424264" style="zoom:33%;" />

在C-S体系结构文件分发中，该服务器必须向每个对等方发送该文件的一个副本，即服务器承受了极大的负担，并且消耗了大量的服务器带宽。

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200212101140227.png" alt="image-20200212101140227" style="zoom:35%;" />

BitTorrent是一种用于**文件分发的流行P2P协议**。参与一个特定文件分发的**所有对等方的集合**被称为一个**洪流（torrent）**。在一个洪流中的对等方彼此下载等长度的文件**块（chunk）**，典型的块长度为256KB。每个洪流具有一个**基础设施节点**，称为**追踪器（tracker）**。当一个对等方加入某洪流时，它向追踪器注册自己，并周期性地通知追踪器它仍在该洪流中。

**最稀缺优先（rarest First）**：邻近对等方中副本数量最少的块，优先请求。为了均衡每个块在洪流中的副本数量。

响应？对换算法：根据当前能够以最高速率向Alice提供数据的邻居，给出其优先权。获得优先权的对等方被称为疏通（unchoked）。每过30秒Alice将随机地选择一名新的对换伴侣并开始与那位伴侣进行对换。如果这两名对等方都满足此对换，它们将对方放入其前4位列表中并继续与对方进行对换，直到该对等方之一发现了一个更好的伴侣为止。

**分布式散列表（DHT）：**是一种简单的数据库，其数据库记录分布在一个P2P系统的多个对等方上。

#### 2.6 视频流和内容分发网站

流式视频服务：使用应用层协议和以像高速缓存那样方式运行的服务器。

比特率：视频的质量，越高，视频质量越好。100kbps～3Mbps。

对流式视频的最为重要的**性能度量**是**平均端到端吞吐量**。

**经HTTP的动态适应性流(Dynamic Adaptive Streaming over HTTP, DASH)**：DASH中有几个不同比特率的编码版本供客户选择。HTTP服务器也有一个**告示文件(manifest file)**，为每个版本提供了一个URL及其比特率。

**内容分发网（Content Distribution Network, CDN）**：CDN管理分布在多个地理位置上的服务器，在它的服务器中存储视频（和其他类型的Web内容，包括文档、图片和音频）的副本。

CDN采用两种不同的**服务器安置原则**：

+ 深入：是通过在遍及全球的接入ISP中部署服务器集群来深入到ISP的接入网中；靠近端用户；
+ 邀请做客：是通过在**少量**（例如10个）关键位置（因特网交换点IXP）建造大集群来邀请到ISP做客。减少维护管理开销。

CDN操作：

+ **截获和重定向**请求所依赖的机制：利用DNS来截获和重定向请求；
+ **集群选择策略（cluster selection strategy）**：到地理上最为**邻近(geographically closest)**的集群、对其集群和客户之间的时延和丢包性能执行周期性的**实时测量(real-time measurement)** ；

#### 2.7 套接字编程：生成网络应用

没看没看没看哭哭哭哭

### 第三章：运输层

#### 3.1 概述和运输层服务

**运输层协议**为运行在不同主机上的应用进程之间提供了**逻辑通信（logic communication）**功能。运输层分组称为报文段（segment）

> 逻辑通信：从逻辑上好像在直接通讯，实际上通过了很多噼里啪啦东

运输层协议是在端系统中实现的，而不是路由器。

网络层提供了**主机之间的逻辑通信**，而运输层为运行在**不同主机上的进程之间提供了逻辑通信**。

运输协议能够提供的服务常常**受制于**底层网络层协议的服务模型。然而，即使底层网络协议不能在网络层提供相应的服务，运输层协议也能提供某些服务。

网络层协议叫网际协议（IP），IP的服务模型是**尽力而为交付服务（best-effort delivery service）**，但是也是**不可靠服务**。

> UDP和TCP所提供的服务模型

将两个端系统间IP的交付服务扩展为运行在端系统上的两个进程之间的交付服务。将主机间交付扩展到进程间交付被称为**运输层的多路复用 (transport-layer multiplexing)与多路分解(demultiplexing)**。

#### 3.2 多路复用和多路分解

**多路分解(demultiplexing)**：在接收端，运输层检查这些字段，标识出接收套接字，进而将报文段定向到该套接字。即将运输层报文段中的数据交付到正确的套接字的工作。

**多路复用(nmhiplexing)**：在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息(这将在以后用于分解)从而生成报文段，然后将报文段传递到网络层。

> 端口号：16比特，0～65535之间；0～1023周知端口号，受限的，保留给http或者ftp之类的周知协议。

1. 无连接的多路复用与多路分解

   <img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200214145708695.png" alt="image-20200214145708695" style="zoom:50%;" />

   一个UDP套接字是由一个**二元组**全面标识的，该二元组包含一个目的IP地址和一个目的端口号。

2. 面向连接的多路复用与多路分解

   <img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200214151259493.png" alt="image-20200214151259493" style="zoom:50%;" />

   TCP套接字是由一个**四元组**（源IP地址，源端口号，目的IP地址，目的端口号）来标识的。

3. web服务器与TCP：事实上, 当今的高性能Web服务器通常只使用一个进程，但是为每个新的客户连接创建一个具有新连接套接字的新线程。

#### 3.3 无连接运输：UDP

UDP只是做了运输协议能够做的最少工作。除了**复用/分解**功能及少量的**差错检测**外，它几乎没有对IP增加别的东西。

**适用UDP的原因：**

+ 关于发送什么数据以及何时发送的应用层控制更为精细：**时间可控**；
+ 无需建立连接，时延更小。例如chrome浏览器中的QUIC协议；
+ 无连接状态，可以支持更多的活跃客户；
+ 分组首部开销小：仅8字节，而TCP报文段有20字节的首部开销。

![image-20200214153323559](/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200214153323559.png)

UDP是可以实现可靠数据传输的，比如说在应用层协议中实现检查确认重传机制。

<u>**UDP报文段结构**</u>

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200214160909044.png" alt="image-20200214160909044" style="zoom:50%;" />

UDP首部只有4个字段，每个字段2个字节，一共32比特。

长度：UDP报文段中的**字节数**，首部+数据；

检验和：判断是否出现了差错；

<u>**UDP检验和**</u>

发送方的UDP对报文段中的所有16比特字的**和**进行**反码运算**，求和时遇到的**任何溢出都被回卷**。得到的结果被放在UDP报文段中的检验和字段。

为什么由运输层提供检验和？不一定所有链路都提供差错检验，并且传输不出错可能存储会出错。在运输层提供检验和遵循了**端到端原则**。（UDP不能修复错误数据）

#### 3.4 可靠数据传输原理

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200214163918608.png" alt="image-20200214163918608" style="zoom:50%;" />

为上层实体提供的**服务抽象**是：数据可以通过一条**可靠的信道**进行传输。借助于可靠信道，传输数据比特就不会受到损坏（由0变为1,或者相反）或丢失，而且所有数据都是按照其发送顺序进行交付。

可靠数据传输协议（reliable data transfer protocol）实现这种服务抽象，但是可靠数据传输协议的下层协议也许是不可靠的。

**单向数据传输(unidirectional data transfe）**

**双向数据传输(bidirectional data transfer)**

> 可靠数据传输协议 rdt

1. 经完全可靠信道的可靠数据传输：rdt1.0（不丢包，比特不出错）

   **有限状态机(Finite-State Machine, FSM）**：每个FSM都只有一个状态，

2. 经具有比特差错信道的可靠数据传输：rdt2.0（不丢包，比特可能出错）

   **自动重传请求（automatic repeat request，ARQ）协议**：

   + 分组检测：分组的分组检验和字段；
   + 接收方反馈：口述报文协议使用肯定确定（positive acknowledgment, ACK）和否定确定（negative acknowledgment, NAK）;
   + 重传；

   **停等协议（stop-and-wait）协议**：发送方处于等待反馈的状态时，不能发送新一块数据。

3. rdt2.1: 比2.0新增了一个字段，存放分组的序号。

4. 经具有比特差错的丢包信道的可靠数据传输：rdt3.0（丢包，出错）

   发送方在一定时间没有收到对方的响应，重传改分组。

   冗余数据分组（duplicate data packet）：如果一个分组经历了一个特别大的时延，发送方可能会重传该分组，而该数据分组或ACK没有丢失。

   因为分组序号在0和1之间交替，rdt3.0被称为**比特交替协议（alternating-bit protocol）**。

> 流水线可靠数据传输协议

**流水线（pipelining）**：从发送方向接收方输送的分组可以被看成是填充到一条流水线中。流水线技术必须增加序号范围，协议的发送方和接收方两端必须缓存多个分组。解决流水线的差错恢复有两种基本方法**回退N步（go-back-N, BGN）**和**选择重传（selective repeat, SR）**。

> 回退N步（BGN）== 滑动窗口协议（sliding-window protocol）

N：窗口长度（window-size）；

GBN协议采取**累积确认（cumulative acknowledgment）**，表明接收方已经正确接受序号n以及n之前所有分组。如果接收方得到的分组是**失序的**，则接收方丢弃该分组，并为最近按序接受的分组重新发送ACK。只需要有1个定时器，接到ACK或者超时则重置。

GBN的意思就是，只要有一个packet没被收到/收到错的/相应的ACK没收到，这个packet之后的所有packet都白传了，丢掉，并一直反馈同一个ACK，直到重新接到那个packet。

接收缓存简单，但是单个分组的差错就能引起大量分组的重传。

> 选择重传（SR）

相对于GBN，SR通过让发送方仅重传那些丢失或受损的packet，避免了不必要的重传。

SR接收方确认一个正确的packet，不管顺序。失序的packet将被缓存直到序号更小的packet被接受。（即使是序号小于当前窗口基序号的packet，正确接受也要确认ACK）每个分组都需要有自己的逻辑定时器。发送方收到ACK，如果ACK序号等于send_base，则窗口滑动到没有确认的最小序号分组上。

SR窗口长度必须 ≤ 序号空间大小的**一半**。

#### 3.5 面向连接的运输：TCP

TCP （Transmission Control Protocol,传输控制协议）：它所谓的连接是一种**逻辑连接**，与电路交换网络中的连接不同，其共同状态只保留在端系统中。**全双工、点对点**的连接。

**三次握手（three-way handshake）**：客户端-服务器-客户端；前两个预备报文段不包含应用层数据，即不承载有效载荷，第三个报文段则可以承载。

**最大报文段长度（maximum segment size, MSS）**: 报文段里应用层数据的最大长度，而不包括首部。这个数值由本地发送主机发送的**最大链路层帧长度（即 最大传输单元，maximum transmission unit, MTU）**来决定。

<u>**TCP报文段格式**</u>

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200221190904484.png" alt="image-20200221190904484" style="zoom:50%;" />

TCP的首部一般是20字节（+选项长度），源端口号、目的端口号和检验和，同UDP。其他字段：

+ 序号和确认号：可靠数据传输；32bit；报文段的序号是该报文段首字节的**字节流编号**，而不是报文段的序列；**确认号是期望从对方那收到的下一字节的序号**，因为TCP采用类似于GBN的累积确认。TCP双方可以随机选择初始序号，可以避免将上次的tcp连接中的报文段混淆进来。
+ 接收窗口：流量控制；16bit
+ 首部长度：包括选项在内的TCP首部长度，≥20字节；4bit
+ 选项：用于发送方和接收方协商MSS/窗口调节因子/时间戳......；
+ 标志：6bit
  + ACK：确认；
  + RST、SYN、FIN：TCP连接的建立和拆除；
  + CWR、ECE：明确拥塞通告；
  + ~~PSH：接收方立即上交；~~
  + ~~URG：紧急数据~~



> 超时时间的设置

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200221193817759.png" alt="image-20200221193817759" style="zoom:50%;" />

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200221193835507.png" alt="image-20200221193835507" style="zoom:50%;" />

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200221193847797.png" alt="image-20200221193847797" style="zoom:50%;" />

估算RTT（EstimatedRTT） 是 样本RTT（sampleRTT） 的指数加权移动平均（EWMA），偏离RTT（devRTT）也是样本与估算RTT之差的EWMA。超时时间初始值推荐为1s，**超时后加倍（这提供了一个形式受限的拥塞控制）**，只要收到报文段并更新估算RTT就再次计算超时时间。

> 可靠数据传输服务

TCP只使用一个定时器。在从应用程序接受到数据、超时、收到ACK的时候都需要重置定时器。每次超时，超时时间加倍；而另两个触发情况则通过公式计算。

TCP的差错恢复机制是GBN和SR协议的混合体：

+ 使用累积确认（不用否定确认），累积确认可以避免一些情况下的ACK丢失引起的不必要的重传（P.162 情况3自动纠正ACK丢失）。—— GBN

+ **缓存但并不逐个确认**失序到达的报文段，即**选择确认机制**（有选择的确认失序报文段），和SR机制结合可以跳过重传这些失序报文段 —— SR

+ 发送方接收到对相同数据的3个冗余ACK则进行**快速重传（在超时之前重传）**。

  1、当A端向B端发送数据报文段时，必须包含（**捎带**）一个确认，它给出A端期望接收的下一个序号。这条规则减少了所需要的报文段的数量，因此也减少了通信量。

  2、当接收方没有数据要发送，但是收到了按序到达（序号是所期望的）的报文段，同时前一个报文段也已经确认过了，那么接收方就推迟发送确认报文段，直到另一个报文段到达，或经过了一段时间（通常是500ms）。换言之，如果仅仅有一个按序到达的报文段还没有被确认，接收方需要推迟发送确认报文段。这条规则也减少了ACK报文段的通信量。

  3、当具有所期望的序号的报文段到达，而且前一个按序到达的报文段还没有被确认，那么接收方就要立即发送ACK报文段。换言之，在任何时候，不能有两个以上按序到达的报文段未被确认。这就避免了不必要的重传，而不必要的重传可能会引起网络的拥塞。

  4、当序号比期望的序号还大的失序报文段到达时，接收方立即发送ACK报文段，并宣布下一个期望的报文段序号。这将导致对丢失报文段的快重传。

  5、当一个丢失的报文段到达时，接收方要发送ACK报文段，并宣布下一个所期望的序号。这是告诉接收方，被通报为丢失的报文段已经接收到了。

  6、如果到达一个重复的报文段，接收方丢弃该报文段，但是应当立即发送确认，指出下一个期望的报文段。这就解决了ACK报文段本身丢失所带来的一些问题。

> 流量控制



#### 3.6 拥塞控制原理



#### 3.7 TCP拥塞控制原理



### 第四章：网络层--数据平面

数据平面：网络层中每台路由器的功能；控制平面：网络范畴的逻辑。

#### 4.1 网络层概述

网络层获得运输层的**报文段**，将每个报文段封装成**数据报**。

> 转发和路由选择

**网络层的两大功能**：

1. **转发（forwarding）**：转发是在数据平面实现的唯一功能，即路由器将输入链路的分组移动到适当的输出链路上；属于路由器的本地动作，时间很短，利用**硬件（处理速度要求很快，软件无法完成）**来实现。**转发表（forwarding table）**是关键！
2. **路由选择（routing）**：在控制平面，通过**<u>路由选择算法</u>**决定分组所采用的路由/路径；网络范围处理过程，时间长，采用软件。

**控制平面**分为传统方法和 SDN（software-defined networking）方法：

1. 传统方法：即每路由器控制，
2. SDN方法：远程控制器计算和分发转发表以供每台路由器使用。

> 网络服务模型（networking service model）：定义了分组在发送和接收端系统之间的端到端运输特性。

因特网的网络层服务：只提供单一服务——**尽力而为服务（best-effort service）**，意思就是啥也不能保证。



#### 4.2 路由器工作原理

一台路由器的4个组件：

1. 输入端口（input port）：执行终结入物理链路的物理层功能；与位于入链路远端的数据链路层交互来执行数据链路层功能；查找功能——查找转发表。
2. 交换结构
3. 输出端口：存储从交换结构接收的分组，并通过执行必要的链路层和物理层功能在输出链路上传输这些分组。
4. 路由选择处理器：执行控制平面的功能。

**转发功能实现的原理：**

+ 输入端口：

  输入端口的线路端接功能与链路层处理 实现了 用于各个输入链路的物理层和链路层。

  转发表从路由选择处理器经过独立总线复制到线路卡，查找转发表通过**最长前缀匹配规则（longest prefix matching rule）**进行匹配。查找的快速决定于：<u>硬件执行、快速查找算法、内存访问时间</u>。

  除了查找，输入端口还需要进行其他操作，例如检查分组版本号、检验和以及寿命字段**（IPv4中）**。

+ 交换结构：

  + 经内存（或是 线路卡）交换：交换在路由选择处理器的控制下完成，内存带宽每秒写入/读出内存最多B个分组，则总的转发吞吐量小于B/2。不能同时转发两个分组。
  + 经总线交换：不需要选择处理器的干预，通过加上内部标签指示，经一根总线将分组直接传送。不能同时转发两个分组。
  + 经互联网络交换：纵横式交换机就是一种2N条总线组成的互联网络，这种结构是非阻塞的，能同时转发多个分组，但是也不能同时传送相同目的输出端口的分组。*更为复杂的多级交换元素可以使来自不同输入端口的分组通过交换结构同时朝着相同的输出端口前行。*

+ 输出端口：略

+ 排队和分组调度：

  1. **输入排队**：发往同一输出端口的分组，其中一个会被阻塞。而排在被阻塞的这个分组之后的其他分组也要等待，这称为：**输入排队交换机中的线路前部（Head-Of-the-Line, HOL）阻塞**。（即使输出端口是空闲

     的）。

  2. **输出排队**：当没有足够的内存来缓存一个入分组时，就必须做出决定：要么丢弃到达的分组（采用一种称为**弃尾（drop tail）**的策略，要么删除一个或多个已排队的分组为新来的分组腾出空间。

     **主动队列管理（Active Queue Manage­ment ,AQM）算法**：在缓存填满之前便丢弃一个分组（或在其首部加上标记）的做法，可以向发送方提供一个拥塞信号。这些策略统称AQM。例如**随机早期检测（Random Early Detection, RED）**算法。

  3. **分组调度（packet scheduler）**：在排队的分组中选择一个分组来传输。分组调度有以下规则：

     + 先进先出：first in first out ,FIFO；
     + 优先排队权：non- preemptive priority queuing，非抢占式优先权排队；同时到达，优先级高的先走；
     + 循环排队规则：round robin queuing discipline，循环调度器在这些类之间轮流提供服务，并**保持工作排队（work-conserving queuing）**，即A、B类轮流执行，A类没有了就一直执行B；
     + 加权公平排队：weighted fair queuing，WFQ；综合了优先级和循环排队规则。

交换

输出端口处理

排队

+ 输入排队
+ 输出排队

分组调度

+ 先进先出
+ 优先权排队
+ 循环和加权公平排队



#### 4.3 网际协议：IPv4、寻址、IPv6及其他

**<u>IPv4数据报格式</u>**

+ 首部长度：4bit，IPv4中有而v6中没有，因为v4中包含一些可变数量的选项，而v6没有，所以v4的首部长度是可变的，需要这个字段来指示数据开始的位置。没有选项的首部20字节。
+ 服务类型（type of service，TOS）：8bit，标示不同类型的数据报，类似v6中的流量类型。
+ 数据报长度：16bit，首部加上数据的总长度。
+ 标识（16bit）、标志（3bit）、片偏移（13bit）：用于IP数据报分片，IPv6没有分片。
+ 寿命（time to live，TTL）：路由器每一跳减一，同IPv6跳限制。
+ 上层协议：指明数据部分应该交给哪个运输层协议，6——TCP，17——UDP。
+ 首部检验和：对首部每16bit进行求和运算，再求反码放在检验和中。**每个路由器都要重新计算检验和，因为每次TTL都会改变。**IP检验和知识对IP首部进行检验，而TCP/UDP的检验和是对整个报文段进行检验。
+ IP地址：32bit

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200222150935791.png" alt="image-20200222150935791" style="zoom:50%;" />



<u>**IPv6数据报格式**</u>

+ 版本同IPv4，流量类型即服务类型；
+ 流标签：12bit，给属于特殊流的分组加上标签，这些特殊流是发送方要求进行特殊处理的流，如一种非默认服务质量或需要实时服务的流；
+ 有效荷载长度：16bit，即数据长度；
+ 下一个首部：即IPv4中的上层协议；
+ 跳限制：即IPv4中的寿命；

<img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200222151007288.png" alt="image-20200222151007288" style="zoom:50%;" />



<u>**IPv4 和 IPv6 的区别**</u>

+ 取消分片
+ 取消首部检验和
+ 取消选项
+ 因为首部长度固定（40字节），所以IPv4中的<u>首部长度</u>和<u>数据报长度</u>简化为<u>有效荷载长度</u>
+ 128bit的地址长度，引入**任播（anycast）地址，这种地址可以使数据报交付给一组主机中的任意一个**
+ 兼容IPv4和IPv6的几种技术：双栈技术（同时具备两种协议栈）；建隧道（tunneling，在IPv6数据报外面包一层IPv4的首部，假装事IPv4，协议号41）

> IPv4分片技术

最大传送单元（MTU）：每个链路层帧能够承载的最大数据量。

**分片（fragment）的原因：每段链路使用不同的链路层协议，每种协议具有不同的MTU。**

IPv4的数据报重新组装工作在端系统中进行，而不是路由器。

**标识（16bit）、标志（3bit）、片偏移（13bit）**

+ 同一个数据报的分片，具有相同标识；不同数据报，标识递增；
+ 最后一个片标志0；其他片标志1；
+ 偏移指示该片原来的位置，用于重组；

> IPv4编址

**接口（interface）**：主机与物理链路之间的边界叫做接口，路由器与它的任意一条链路之间的边界也叫做接口。IP要求每台主机和路由器接口拥有自己的IP地址。

因此，**一个IP地址与一个接口相关联**

**点分十进制记法（dotted-decimal notation）**：每个点之间8比特，0～255

互连一些主机接口和路由器接口的网络形成一个**子网（subnet）**，子网决定IP地址中的一部分。

​	例如：223.1.1.0/24；/24记法称为**子网掩码（network mask）**，32bit左侧的24bit定义了子网地址

**无类别域间路由选择（classless interdomain routing，CIDR）**：IP地址被分为两部分，前x位是IP地址的网络部分，即地址的**前缀（prefix）**；剩余32-x比特用于组织内部设备区分。

+ 分类编址（classful addressing）：CIDR之前的编址方案，ABCD分类不是太大就是太小。

**<u>一个设备如何分配地址：</u>**：

1. 获取一块地址：因特网名字和编号分配机构（ICANN）进行分配；

2. 获取主机地址：可以手动分配，或者**动态主机配置协议（dynamic host configuration protocol，DHCP）**完成分配。DHCP能给主机分配IP地址、告知其子网掩码、他的第一跳路由器地址（默认网关）及它的本地DNS服务器地址。DHCP也被称为**即插即用协议（plug-and-play protocol）**或者**零配置（zeroconf）协议**。

   DHCP是一个客户-服务器协议。一个子网需要一台DHCP服务器或者DHCP中继代理，详情如下：

   1. DHCP服务器发现：客户端通过DHCP发现报文（67端口的UDP报文）广播，目的地址255.255.255.255，源地址0.0.0.0
   2. 服务器提供：服务器通过DHCP提供报文（广播），响应该发现报文
   3. DHCP请求报文，回显配置的参数
   4. DHCP ACK响应，证实所要求的参数

3. > 第六章讲移动IP

> 网络地址转换NAT

Network address translation, NAT 网络地址转换：**通过使用少量的公有IP 地址代表较多的私有IP 地址的方式**，将有助于减缓可用的IP地址空间的枯竭。地址空间10.0.0.0/8事保留的三部分IP地址空间之一，用于家庭网络等专用网络（private network）或具有专用地址的地域（realm with private address）。这些地址只对该网络中的设备有意义。

**中间盒**：并不执行传统的转发功能，而是执行诸如NAT、流量流的负载均衡、流量防火墙等功能。

#### 4.4 通用转发和SDN

中间盒的功能可以抽象为：**匹配和动作**两个范式。这种转发表称为流表，每个表项包括

+ 首部字段值的集合
+ 计数器集合
+ 所采取的动作集合：转发、丢弃、修改字段



### 第五章：网络层--控制平面

网络层的控制平面：控制沿着从源主机到目的主机的端到端路径间的**路由器如何转发数据报（路由选择算法及协议）**，而且控制**网络层组件和服务如何配置和管理（SDN、ICMP和SNMP）**。

#### 5.1 概述

链接网络层的数据平面和控制平面的首要元素：**转发表或流表**。第五章主要讲如何**计算、维护和安装转发表**。完成以上工作的两种方法：

1. **每路由器控制**：每台路由器运行算法，各自执行转发和路由选择功能，与其他路由器通信。OSPF和GBP协议都是基于这种方法进行控制的。
2. **逻辑集中式控制**：<u>通用转发</u>；控制代理（CA）与逻辑集中式控制器通信并且按控制器命令行事，CA们并不能直接相互交互。

#### 5.2 路由选择算法

**路由选择算法（routing algorithm）**：目的是从发送方到接收方的过程中确定一条通过路由器网络的好的路径（等价于路由）。

**<u>分类：</u>**

1. 集中式路由选择算法（centralized routing algorithm）：具有关于连通性和链路开销方面的完整信息，例如**链路状态算法（link state）**；
2. 分散式路由选择算法（decentralized routing algorithm）：路由器只有直接相连链路信息，以迭代、分布式的方式计算出最低开销路径，例如**距离向量算法（distance-vector，DV）**。

----

1. 静态路由选择算法：变化缓慢 / 动态路由选择算法：随着网络流量负载或拓扑变化
2. 负载敏感算法 / 负载迟钝算法（包括OSPF和BGP）

**<u>举例说明：</u>**

LS链路状态路由选择算法：每个节点向网络中其他节点广播链路状态分组，并使用Dijkstra算法计算。但是该算法可能产生路由振荡，让所有路由器发送链路通告的时间随机化可以避免这一问题。

DV距离向量路由选择算法：迭代的、异步的、收敛的、分布式的算法。但是该算法在链路开销改变和链路故障的时候，可能会产生路由选择环路，有时可以使用毒性逆转来解决。

相比之下，LS算法的报文开销较大，但是收敛性和健壮性更好，DV算法的一个不正确的节点值会扩散到整个网络。



#### 5.3 因特网中自治系统内部的路由选择：OSPF

将路由器组织进**自治系统（autonomous system，AS）**，可以解决网络开销巨大、ISP管理自治的问题。一个自治系统有全局唯一的AS号（ASN）所标识。

在相同AS中的路由器都运行**相同的路由选择算法**并且有彼此的信息。在一个自治系统内运行的路由选择算法叫作**自治系统内部路由选择协议（intra-autonomous system routing protocol）。开放式最短路径优先**（Open Shortest Path First，OSPF） 是对LS算法协议的一种实现，隶属内部网关协议（IGP）。

OSPF通告包含在OSPF报文中，该OSPF报文直接由IP承载，**对OSPF其上层协议的值为89**。因此OSPF协议必须自己实现诸如可靠报文传输、链路状态广播等功能。

优点：

+ 安全：能够鉴别一个AS内的OSPF路由器之间的交换；
+ 多条相同开销的路径：当存在多条相等开销的路径时，无须仅选择单一的路径来承载所有的流量；
+ 对单播于多播路由选择的综合支持；
+ 支持在单个AS中的层次结构。一个OSPF自治系统能够层次化地配置多个区域。在每个区域内，一台或多台区域边界路由器负责为流向该区域以外的分组提供路由选择。最后，在AS中只有一个OSPF区域配置成主干区域。



#### 5.4 ISP之间的路由选择：BGP

**自治系统间路由选择协议（inter-autonomous system routing protocol）** ：因为AS间路由选择协议涉及多个AS之间的协调，所以AS通信必须运行相同的AS间路由选择协议。在因特网中，所有的AS运行**相同**的AS间路由选择协议，称为**边界网关协议（Broder Gateway Protocol, BGP）**。

BGP是一种分布式、异步的协议。在BGP中，分组将路由到CIDR化的前缀（一个子网或者子网的集合），它的作用：

1. 从邻居AS获得前缀的可达性信息：BGP允许每个子网向因特网的其余部分通告它的存在。
2. 确定到该前缀的“最好的”路由



#### 5.5 SDN控制平面



#### 5.6 ICMP：因特网控制报文协议



#### 5.7 网络管理和SNMP





### 第六章：链路层和局域网

#### 6.1 链路层概述

**节点(node)**：运行链路层协议的任何设备均称为节点，包括主机、路由器、交换机和WiFi接入点 。

**链路(link)** ：沿着通信路径连接相邻节点的通信信道。

**媒体访问控制（Medium Access Control, MAC）**：协议规定了帧在链路上传输的规则，协调多个节点的帧传输。

<u>**链路层提供的服务：**</u>

1. framing成帧：包装数据报为链路层帧；
2. 链路接入：媒体访问控制来协调；
3. 可靠交付：本地纠错而不是依靠运输层的重传；
4. 差错检测和纠正：链路层的差错检测通常更复杂，并且用硬件实现。差错纠正：接收方不仅能检测帧中出现的比特差错，而且能够准确地确定帧中的差错出现的位置。

**<u>链路层在何处实现？</u>**：

1. 路由器的线路卡；

2. 主机中：链路层是硬件和软件的结合体，即此处是协议栈中软件与硬件交接的地方。

   硬件：主体部分是在**网络适配器（network adapter）**中实现的，网络适配器有时也称为**网络接口卡（Network Interface Card, NIC）**。位于网络适配器核心的是**链路层控制器**，该控制器通常是一个实现了许多链路层服务的专用芯片。

   软件：部分链路层是在运行于**主机CPU上的软件**中实现的。链路层的软件组件实现了高层链路层功能，如组装 链路层寻址信息和激活控制器硬件。在接收端，链路层软件响应控制器中断、处理差错条件和将数据报向上传递给网络层。

   

#### 6.2 差错检测和纠正技术

比特级差错检测和纠正（bit-level error detection and correction），需要**差错检测和纠正比特（Error- Detection and- Correction，EDC）**来增强数据D。

**前向纠错（Forward Error Correction,FEC）**：接收方检测和纠正差错的能力。在网络环境中，FEC技术可以单独应用，或与链路层ARQ技术一起应用。它们可以减少所需的发送方重发的次数，减少时延。

3种技术：

1. 奇偶校验：

   单个奇偶校验位（parity bit）：偶校验方案中，发送发只需要包含一个附加的比特，选择它的值，使d+1bit中1的总数是偶数。可以检出奇数个比特差错。

   二维奇偶校验（two-dimensional parity）：可以检测并纠正。

2. 检验和：类似运输层

3. 循环冗余检测（Cyclic Redundancy Check, CRC）：一种信道编码技术，属于**多项式编码（polynomial code）**。

   <img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200227221431161.png" alt="image-20200227221431161" style="zoom:50%;" />

   <img src="/Users/chengleiyi/Library/Application Support/typora-user-images/image-20200227221534847.png" alt="image-20200227221534847" style="zoom:50%;" />

   

#### 6.3 多路访问链路和协议



#### 6.4 交换局域网



#### 6.5 链路虚拟化：网络作为链路层



#### 6.6 数据中心网络



#### 6.7 回顾Web网页请求的历程



### 第七章：无线网络和移动网络

无线不一定是移动的，移动的不一定是无线。

#### 7.1 概述



#### 7.2 无线链路和网络特征



#### 7.3 WI-FI：802.11无限LAN

在IEEE 802. 11 协议族中有几套有关无线LAN的802. 11标准。不同的802. 11标准都共同特征：

- 它们都使用相同的媒体访问协议CSMA/CA
- 它们的链路层帧也都使用相同的帧结构
- 它们都具有减少其传输速率的能力以伸展到更远的距离
- 都是向后兼容的

区别：工作在2.4GHz或者5GHz



> 802.11体系结构

体系结构的基本构件模块是**基本服务集（Basic Service Set, BSS）**： 一个BSS包含一个或多个**无线站点**和一个**接入点（Access Point, AP）**【即中央基站（base station）】。

+ 每个无线站点和接入点的无线接口都具有6字节的MAC地址。
+ 配置AP的无线LAN经常被称作**基础设施无线LAN （infrastructure wireless LAN）**，其中的“基础设施”是指**AP连同互联AP和一台路由器的有线以太网。**
+ **自组织网络**：即一个 无中心控制和与“外部世界”无连接的网络，没有预先存在的网络基础设施。
+ 当网络管理员安装一个AP时，管理员为该接入点分配一个单字或双字的**服务集标识符（Service Set Identifier, SSID）**和一个**信道号**（2.4GHz网络中11个部分重叠的信道，1、6、11互不重叠）。

**WiFi丛林（WiFi jungle）**是一个任意物理位置，在这里无线站点能从两个或多个AP中收到很强的信号。

关联(associate)：为了获得因特网接入，你的无线站点需要加入其中一个子网并因此需要与其中的一个AP相关联，即这一无线站点在自身和该AP之间创建一个**虚拟线路**。

无线站点获取丛林中的AP方式：

+ 被动扫描：每个AP周期性地发送**信标帧（beacon frame）**,每个信标帧包括该AP的SSID和MAC地址。你的无线站点为了得知正在发送信标帧的AP，扫描11个信道，找出来自可能位于该区域的AP所发出的信标帧。
+ 主动扫描：通过向位于无线主机范围内的所有AP广播探测帧完成的

**选择一个AP后，对它发送关联请求帧。AP响应，从而建立关联。**--》 关联后，主机向该子网发送DHCP发现报文请求分配IP地址，从而加入子网。



> 802.11 MAC协议

与以太网类似，wifi也需要多路访问协议来协调传输：

+ 相同：随机访问协议，载波侦听多路访问（CSMA），传输前侦听信道，一旦侦听到信道忙就抑制传输；

+ 区别：
  1. 以太网：CSMA/CD碰撞检测；wifi：CSMA/CA碰撞避免；
  2. wifi使用链路层确认/重传ARQ方案

#### 7.4 蜂窝因特网接入



#### 7.5 移动管理：原理



#### 7.6 移动IP



#### 7.7 管理蜂窝网中的移动性



#### 7.8 无线和移动性：对高层协议的影响



### 第八章：计算机网络中的安全



### 第九章：多媒体网络



###面试题

1. **应用层：HTTP和HTTPS**

   HTTP的工作原理？

   HTTP的请求、响应、缓存？

   HTTP1.0和HTTP1.1的区别？

   HTTP和HTTPS有什么区别？

   HTTPS如何保障安全？

   GET与POST的区别？
   Session与Cookie的区别？
   从输入网址到获得页面的过程 (越详细越好)？
   HTTP请求有哪些常见状态码？

   HTTP请求头有哪些？

   DNS使用的协议？

   URI和URL的区别？

   （Nginx）负载均衡反向代理模式优点及缺点？

   

2. **传输层：TCP和UDP**

   传输层的作用？

   TCP的长连接和短连接？

   什么是三次握手？如果握手只有两次，会出现什么？
   什么是四次挥手？TIME_WAIT和CLOSE_WAIT的区别？
   TCP如何实现流量控制？
   TCP如何实现拥塞控制？

   TCP如何保证传输的可靠性？如何实现可靠性？

   TCP与UDP的区别？
   什么是TCP粘包？

   Linux下IO模型有几种，各自的含义是什么？

3. **网络层**
   什么是RIP (距离矢量路由协议)?
   IP地址的分类？
   什么叫划分子网？
   什么是ARP协议？
   什么是NAT (网络地址转换)？

4. **链路层**

   路由器和交换机的区别？

   

5. **计算机网络体系结构**

   四层：TCP/IP四层协议，应用层、运输层、网际层IP、网络接口层

   五层：物理、链路、网络、运输、应用层；

   七层：ISO国际标准化组织定义的OSI开放系统互连模型，应用层下多表示层（翻译，编码，压缩，加密）和会话层（创建/建立/断开连接）；

   

   分别有哪些协议？

   